{% extends 'base.jinja2' %}
{% from 'macros/value_or_default.jinja2' import value_or_default %}
{% from 'macros/add_indicator_links.jinja2' import add_indicator_links %}
{% from 'macros/generate_project_type_dropdown.jinja2' import generate_project_type_dropdown %}
{% block title %}{{ Projects }} {% endblock %}
{% block page_title %}
  <h3 class="page-title">
    {{ community.name }}
    <small></small>
  </h3>
{% endblock %}
{% block breadcrumbs %}
  <li>
      <a href="#">Projects Indicators</a>
      <i class="icon-angle-right"></i>
  </li>
  <li>
      <a href="#">County</a>
      <i class="icon-angle-right"></i>
  </li>
  <li>
      <a href="#">Sub County</a>
      <i class="icon-angle-right"></i>
  </li>
  <li>
      <a href="#">Constituency</a>
      <i class="icon-angle-right"></i>
  </li>
  <li>
      {{ community.name }}
  </li>

{% endblock %}
{% block indicators %}
  {{ add_indicator_links(request, 'community', community) }}
{% endblock %}
{% block content %}
{% for sector, report, label in project_types %}
<div class="row">
  <div class="col-md-12">
    <!-- BEGIN SAMPLE TABLE PORTLET-->
    <div class="portlet">
      <div class="portlet-title">
        <div class="caption">
          <i class="icon-tasks"></i>
          {{ community.name }} {{ gettext(label) }} {% trans %}Projects{% endtrans %}
        </div>
      </div>
      <div class="portlet-body">
        {% if sector_aggregated_indicators[sector]['indicator_list'] %}
         <div class="table-responsive table-scrollable">
            <table class="table table-striped table-bordered table-hover">
               <thead>
                  <tr>
                    <th>{% trans %}Project Name{% endtrans %}</th>
                    {% for indicator in sector_indicator_mapping[sector] %}
                      <th>
                        {{ indicator['title'] }}
                      </th>
                    {% endfor %}
                  </tr>
               </thead>
               <tbody>
                  <tr>
                    <td>
                      {% trans %} Total Summary {% endtrans %}
                    </td>
                    {% for indicator in sector_indicator_mapping[sector] %}
                        <td>
                          {% set target, actual, percentage = indicator['group']%}
                          {% set indicators = sector_aggregated_indicators[sector]['summary']%}
                               {{ value_or_default(indicators[percentage]) }}({{ value_or_default(indicators[actual]) }}/{{ value_or_default(indicators[target]) }})
                        </td>
                    {% endfor %}
                  </tr>
                  {% for project_indicator_map in sector_aggregated_indicators[sector]['indicator_list'] %}
                    <tr>
                      <td>
                          <a href="{{ request.route_url('projects', traverse=(project_indicator_map['project_id'], 'show')) }}">
                            {{ project_indicator_map['project_name'] }}
                          </a>
                      </td>
                      <div>
                      </div>
                      {% for indicator in sector_indicator_mapping[sector] %}
                            {% set target, actual, percentage = indicator['group']%}
                            {% set indicators = project_indicator_map['indicators'] %}
                          <td>
                            {{ value_or_default(indicators[percentage])}}({{ value_or_default(indicators(actual)) }}/{{ value_or_default(indicators[target])}} )
                          </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
               </tbody>
            </table>
         </div>
        {% else %}
          <div> {% trans %} No Projects found within {% endtrans %}{{ community.name }}</div>
        {% endif %}
      </div>
    </div>
    <!-- END SAMPLE TABLE PORTLET-->
  </div>
</div>
{% endfor %}
{{response}}
{% endblock content %}
